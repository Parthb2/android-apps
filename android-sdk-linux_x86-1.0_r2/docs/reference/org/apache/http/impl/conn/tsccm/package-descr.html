






















































 








<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>org.apache.http.impl.conn.tsccm Details - Android SDK</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../assets/codesite/codesite.css" />
<link rel="stylesheet" type="text/css" href="../../../../../../../assets/codesite/codesearch.css" />
<link rel="stylesheet" type="text/css" href="../../../../../../../assets/codesite/semantic_headers.css" />
<link rel="stylesheet" type="text/css" href="../../../../../../../assets/style.css" />
<script src="../../../../../../../assets/search_autocomplete.js"></script>
<script src="../../../../../../../reference/lists.js"></script>
</head>

<body class="gc-documentation">
<div id="gc-container">
<a name="top"></a>

<div id="gc-header">
<div id="logo">
    <a href="http://code.google.com/android/"><img style="border: 0;" src="../../../../../../../assets-google/android-logo.gif"/></a>
</div> <!-- logo -->
</div> <!-- gc-header -->


<iframe id="backiFrame" name="backiFrame" style="display:none"></iframe>

<div id="codesiteContent" style="margin-top: 50px;">

<div id="gc-topnav">
    <span class="jd-toptitle">Android</span>
</div>

<div class="g-section g-tpl-180">

<a name="gc-toc-anchor"></a>  
<div class="g-unit g-first" id="gc-toc">
<div id="jd-searchbox" style="margin-top: 1px;">
    <input id="search_autocomplete"
            tabindex="1"
            autocomplete="off" type=text size="23"
            style="font-size:85%; color: #aaaaaa"
            value="(quick search)"
            onfocus="search_focus_changed(this, true)"
            onblur="search_focus_changed(this, false)"
            onkeydown="return search_changed(event, true, '../../../../../../../')"
            onkeyup="search_changed(event, false, '../../../../../../../')"
            onchange="search_changed(event, false, '../../../../../../../')"/>
    <div style="position: absolute;">
        <table id="search_filtered" class="jd-autocomplete-table-hidden"
                style="border: 1px solid #3366cc;"
                cellspacing=0>
        </table>
    </div>
</div>

<ul>
  <li>
    <h1><a href="../../../../../../../documentation.html">Documentation</a></h1>
    <ul>
      <li><a href="../../../../../../../what-is-android.html"><strong>What is Android?</strong></a></li>
      <li>
        <a href="../../../../../../../intro/index.html"><strong>Getting Started</strong></a>
        <ul>
          <li><a href="../../../../../../../intro/installing.html">Installing the SDK</a></li>
          <li><a href="../../../../../../../intro/upgrading.html">Upgrading the SDK</a></li>
          <li><a href="../../../../../../../intro/develop-and-debug.html">Developing/Debugging</a></li>
          <li><a href="../../../../../../../intro/hello-android.html">Hello Android</a></li>
          <li><a href="../../../../../../../intro/anatomy.html">Anatomy of an App</a></li>
          <li><a href="../../../../../../../intro/tutorial.html">Notepad Tutorial</a></li>
          <li><a href="../../../../../../../intro/tools.html">Development Tools</a></li>
          <li><a href="../../../../../../../intro/appmodel.html">Application Model</a></li>
          <li><a href="../../../../../../../intro/lifecycle.html">Application Life Cycle</a></li>
        </ul>
      </li>
      <li>
        <a href="../../../../../../../devel/index.html"><strong>Developing Applications</strong></a>
        <ul>
          <li><a href="../../../../../../../devel/implementing-ui.html">Implementing a UI</a></li>
          <li><a href="../../../../../../../devel/building-blocks.html">Building Blocks</a></li>
          <li><a href="../../../../../../../devel/data.html">Data Storage and Retrieval</a></li>
          <li><a href="../../../../../../../devel/security.html">Security Model</a></li>
          <li><a href="../../../../../../../devel/resources-i18n.html">Resources and i18n</a></li>
          <li><a href="../../../../../../../devel/sign-publish.html">Signing and Publishing Your App</a></li>
        </ul>
      </li>
      <li>  
        <a href="../../../../../../../toolbox/index.html"><strong>Developer Toolbox</strong></a>
        <ul>
          <li><a href="../../../../../../../toolbox/philosophy.html">Design Philosophy</a></li>
          <li><a href="../../../../../../../toolbox/custom-components.html">Building Custom Components</a></li>
          <li><a href="../../../../../../../toolbox/optional-apis.html">Optional APIs</a></li>
        </ul>
      </li>
      <li>  
        <a href="../../../../../../../reference/index.html"><strong>Reference Information</strong></a>
        <ul>
          <li><a href="../../../../../../../reference/packages.html">Package Index</a></li>
          <li><a href="../../../../../../../reference/classes.html">Class Index</a></li>
          <li><a href="../../../../../../../reference/hierarchy.html">Class Hierarchy</a></li>
          <li><a href="../../../../../../../reference/view-gallery.html">List of Views</a></li>
          <li><a href="../../../../../../../reference/available-intents.html">List of Intents</a></li>
          <li><a href="../../../../../../../reference/android/Manifest.permission.html">List of Permissions</a></li>
          <li><a href="../../../../../../../reference/available-resources.html">List of Resource Types</a></li>
          <li><a href="../../../../../../../reference/aidl.html">Android IDL</a></li>
          <li><a href="../../../../../../../reference/glossary.html">Glossary</a></li>
          <li><a href="../../../../../../../reference/keywords.html">Index</a></li>
        </ul>
      </li>
      
      <li>  
        <a href="../../../../../../../kb/index.html"><strong>FAQs</strong></a>
        <ul>
          <li><a href="../../../../../../../kb/general.html">General</a></li>
          <li><a href="../../../../../../../kb/commontasks.html">Common Tasks</a></li>
          <li><a href="../../../../../../../kb/troubleshooting.html">Troubleshooting</a></li>
          <li><a href="../../../../../../../kb/licensingandoss.html">Open Source Licensing</a></li>
	  <li><a href="../../../../../../../kb/framework.html">Application Framework</a></li>
	  <li><a href="../../../../../../../kb/security.html">Security</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <h1><a href="../../../../../../../roadmap.html">Roadmap</a></h1>
  </li>
  <li>
    <h1><a href="../../../../../../../goodies/index.html">Goodies</a></h1>
  </li>
</ul>


</div>

<a name="gc-pagecontent-anchor"></a>   
<div class="g-unit" id="gc-pagecontent">


<div id="jd-content">

<div class="jd-page_title-prefix">package</div>
<h1>org.apache.http.impl.conn.tsccm</b></h1>

<div class="jd-nav">
    <a class="jd-navlink" href="package-summary.html">Classes</a> |
    Description
</div>

<div class="jd-descr">
<p>The implementation of a thread-safe client connection manager.

<center>
<img src="doc-files/tsccm-structure.png" alt="Relation Diagram"/>
</center>

<p>
The implementation is structured into three areas, as illustrated
by the diagram above.
Facing the application is the <i>Manager</i> (green), which internally
maintains a <i>Pool</i> (yellow) of connections and waiting threads.
Both Manager and Pool rely on <i>Operations</i> (cyan) to provide the
actual connections.
</p>
<p>
In order to allow connection garbage collection, it is
imperative that hard object references between the areas are
restricted to the relations indicated by arrows in the diagram:
</p>
<ul>
<li>Applications reference only the Manager objects.</li>
<li>Manager objects reference Pool objects, but not vice versa.</li>
<li>Operations objects do not reference either Manager or Pool objects.</li>
</ul>

<p>
The following table shows a selection of classes and interfaces,
and their assignment to the three areas.
</p>
<center>
<table border="1">
<colgroup>
  <col width="50%"/>
  <col width="50%"/>
</colgroup>

<tr>
<td style="text-align: center; background-color: #00ff00;">
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/ThreadSafeClientConnManager.html">ThreadSafeClientConnManager</a>
</td>
<td style="text-align: center; background-color: #ffff00;">
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/AbstractConnPool.html">AbstractConnPool</a>
</td>
</tr>

<tr>
<td style="text-align: center; background-color: #00ff00;">
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/BasicPooledConnAdapter.html">BasicPooledConnAdapter</a>
</td>
<td style="text-align: center; background-color: #ffff00;">
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/ConnPoolByRoute.html">ConnPoolByRoute</a>
</td>
</tr>

<!-- appears on both sides! -->

<tr>
<td style="text-align: right; background-color: #00ff00;">
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/BasicPoolEntry.html">BasicPoolEntry</a>
</td>
<td style="text-align: left; background-color: #ffff00;">
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/BasicPoolEntry.html">BasicPoolEntry</a>
</td>
</tr>

<!-- ====================== -->

<tr style="border-width: 5px;">
</tr>

<tr>
<td colspan="2" style="text-align: center; background-color: #00ffff;">
<a href="../../../../../../../reference/org/apache/http/conn/ClientConnectionOperator.html">ClientConnectionOperator</a>
</td>
</tr>

<tr>
<td colspan="2" style="text-align: center; background-color: #00ffff;">
<a href="../../../../../../../reference/org/apache/http/conn/OperatedClientConnection.html">OperatedClientConnection</a>
</td>
</tr>

</table>
</center>

<p>
The Manager area has implementations for the connection management
interfaces <a href="../../../../../../../reference/org/apache/http/conn/ClientConnectionManager.html">ClientConnectionManager</a>
and <a href="../../../../../../../reference/org/apache/http/conn/ManagedClientConnection.html">ManagedClientConnection</a>.
The latter is an adapter from managed to operated connections, based on a
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/BasicPoolEntry.html">BasicPoolEntry</a>.
<br/>
The Pool area shows an abstract pool class
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/AbstractConnPool.html">AbstractConnPool</a>
and a concrete implementation
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/ConnPoolByRoute.html">ConnPoolByRoute</a>
which uses the same basic algorithm as the
<code>MultiThreadedHttpConnectionManager</code>
in HttpClient 3.x.
A pool contains instances of
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/BasicPoolEntry.html">BasicPoolEntry</a>.
Most other classes in this package also belong to the Pool area.
<br/>
In the Operations area, you will find only the interfaces for
operated connections as defined in the org.apache.http.conn package.
The connection manager will work with all correct implementations
of these interfaces. This package therefore does not define anything
specific to the Operations area.
</p>

<p>
As you have surely noticed, the
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/BasicPoolEntry.html">BasicPoolEntry</a>
appears in both the Manager and Pool areas.
This is where things get tricky for connection garbage collection.
<br/>
A connection pool may start a background thread to implement cleanup.
In that case, the connection pool will not be garbage collected until
it is shut down, since the background thread keeps a hard reference
to the pool. The pool itself keeps hard references to the pooled entries,
which in turn reference idle connections. Neither of these is subject
to garbage collection.
Only the shutdown of the pool will stop the background thread,
thereby enabling garbage collection of the pool objects.
<br/>
A pool entry that is passed to an application by means of a connection
adapter will move from the Pool area to the Manager area. When the
connection is released by the application, the manager returns the
entry back to the pool. With that step, the pool entry moves from
the Manager area back to the Pool area.
While the entry is in the Manager area, the pool MUST NOT keep a
hard reference to it.
</p>

<p>
The purpose of connection garbage collection is to detect when an
application fails to return a connection. In order to achieve this,
the only hard reference to the pool entry in the Manager area is
in the connection wrapper. The manager will not keep a hard reference
to the connection wrapper either, since that wrapper is effectively
moving to the Application area.
If the application drops it's reference to the connection wrapper,
that wrapper will be garbage collected, and with it the pool entry.
<br/>
In order to detect garbage collection of pool entries handed out
to the application, the pool keeps a <i>weak reference</i> to the
entry. Instances of
<a href="../../../../../../../reference/org/apache/http/impl/conn/tsccm/BasicPoolEntryRef.html">BasicPoolEntryRef</a>
combine the weak reference with information about the route for
which the pool entry was allocated. If one of these entry references
becomes stale, the pool can accommodate for the lost connection.
This is triggered either by a background thread waiting for the
references to be queued by the garbage collector, or by the
application calling a <a href="../../../../../../../reference/org/apache/http/conn/ClientConnectionManager.html#closeIdleConnections(long, java.util.concurrent.TimeUnit)">cleanup</a>
method of the connection manager.
<br/>
Basically the same trick is used for detecting garbage collection
of the connection manager itself. The pool keeps a weak reference
to the connection manager that created it. However, this will work
only if there is a background thread to detect when that reference
is queued by the garbage collector. Otherwise, a finalizer of the
connection manager will shut down the pool and release it's resources.
</p>


</p>
</div>

</div>
</div><!-- end gc-pagecontent -->
</div><!-- end gooey wrapper -->

<div style="padding-left: 10px; padding-right: 10px; margin-top: 0; padding-bottom: 15px;">
    <table style="width: 100%; border:none;"><tr>
    <td style="border: none; width: 150px;"></td>
    <td style="text-align: left; font-size: 10pt; border: none; color: silver;">Copyright 2007 <a href="http://labs.google.com/">Google Inc.</a></td>
    <td style="text-align: right; font-size: 10pt; border: none; color: silver;">Build 119366-119366 - 19 Nov 2008 16:04</td>
    </tr></table>
</div>


</body>

</html>
