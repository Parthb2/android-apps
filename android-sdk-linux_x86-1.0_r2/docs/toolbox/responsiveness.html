






















































 








<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Developing Responsive Applications</title>
<link rel="stylesheet" type="text/css" href="../assets/codesite/codesite.css" />
<link rel="stylesheet" type="text/css" href="../assets/codesite/codesearch.css" />
<link rel="stylesheet" type="text/css" href="../assets/codesite/semantic_headers.css" />
<link rel="stylesheet" type="text/css" href="../assets/style.css" />
<script src="../assets/search_autocomplete.js"></script>
<script src="../reference/lists.js"></script>
</head>

<body class="gc-documentation">
<div id="gc-container">
<a name="top"></a>

<div id="gc-header">
<div id="logo">
    <a href="http://code.google.com/android/"><img style="border: 0;" src="../assets-google/android-logo.gif"/></a>
</div> <!-- logo -->
</div> <!-- gc-header -->


<iframe id="backiFrame" name="backiFrame" style="display:none"></iframe>

<div id="codesiteContent" style="margin-top: 50px;">

<div id="gc-topnav">
    <span class="jd-toptitle">Android</span>
</div>

<div class="g-section g-tpl-180">

<a name="gc-toc-anchor"></a>  
<div class="g-unit g-first" id="gc-toc">
<div id="jd-searchbox" style="margin-top: 1px;">
    <input id="search_autocomplete"
            tabindex="1"
            autocomplete="off" type=text size="23"
            style="font-size:85%; color: #aaaaaa"
            value="(quick search)"
            onfocus="search_focus_changed(this, true)"
            onblur="search_focus_changed(this, false)"
            onkeydown="return search_changed(event, true, '../')"
            onkeyup="search_changed(event, false, '../')"
            onchange="search_changed(event, false, '../')"/>
    <div style="position: absolute;">
        <table id="search_filtered" class="jd-autocomplete-table-hidden"
                style="border: 1px solid #3366cc;"
                cellspacing=0>
        </table>
    </div>
</div>

<ul>
  <li>
    <h1><a href="../documentation.html">Documentation</a></h1>
    <ul>
      <li><a href="../what-is-android.html"><strong>What is Android?</strong></a></li>
      <li>
        <a href="../intro/index.html"><strong>Getting Started</strong></a>
        <ul>
          <li><a href="../intro/installing.html">Installing the SDK</a></li>
          <li><a href="../intro/upgrading.html">Upgrading the SDK</a></li>
          <li><a href="../intro/develop-and-debug.html">Developing/Debugging</a></li>
          <li><a href="../intro/hello-android.html">Hello Android</a></li>
          <li><a href="../intro/anatomy.html">Anatomy of an App</a></li>
          <li><a href="../intro/tutorial.html">Notepad Tutorial</a></li>
          <li><a href="../intro/tools.html">Development Tools</a></li>
          <li><a href="../intro/appmodel.html">Application Model</a></li>
          <li><a href="../intro/lifecycle.html">Application Life Cycle</a></li>
        </ul>
      </li>
      <li>
        <a href="../devel/index.html"><strong>Developing Applications</strong></a>
        <ul>
          <li><a href="../devel/implementing-ui.html">Implementing a UI</a></li>
          <li><a href="../devel/building-blocks.html">Building Blocks</a></li>
          <li><a href="../devel/data.html">Data Storage and Retrieval</a></li>
          <li><a href="../devel/security.html">Security Model</a></li>
          <li><a href="../devel/resources-i18n.html">Resources and i18n</a></li>
          <li><a href="../devel/sign-publish.html">Signing and Publishing Your App</a></li>
        </ul>
      </li>
      <li>  
        <a href="../toolbox/index.html"><strong>Developer Toolbox</strong></a>
        <ul>
          <li><a href="../toolbox/philosophy.html">Design Philosophy</a></li>
          <li><a href="../toolbox/custom-components.html">Building Custom Components</a></li>
          <li><a href="../toolbox/optional-apis.html">Optional APIs</a></li>
        </ul>
      </li>
      <li>  
        <a href="../reference/index.html"><strong>Reference Information</strong></a>
        <ul>
          <li><a href="../reference/packages.html">Package Index</a></li>
          <li><a href="../reference/classes.html">Class Index</a></li>
          <li><a href="../reference/hierarchy.html">Class Hierarchy</a></li>
          <li><a href="../reference/view-gallery.html">List of Views</a></li>
          <li><a href="../reference/available-intents.html">List of Intents</a></li>
          <li><a href="../reference/android/Manifest.permission.html">List of Permissions</a></li>
          <li><a href="../reference/available-resources.html">List of Resource Types</a></li>
          <li><a href="../reference/aidl.html">Android IDL</a></li>
          <li><a href="../reference/glossary.html">Glossary</a></li>
          <li><a href="../reference/keywords.html">Index</a></li>
        </ul>
      </li>
      
      <li>  
        <a href="../kb/index.html"><strong>FAQs</strong></a>
        <ul>
          <li><a href="../kb/general.html">General</a></li>
          <li><a href="../kb/commontasks.html">Common Tasks</a></li>
          <li><a href="../kb/troubleshooting.html">Troubleshooting</a></li>
          <li><a href="../kb/licensingandoss.html">Open Source Licensing</a></li>
	  <li><a href="../kb/framework.html">Application Framework</a></li>
	  <li><a href="../kb/security.html">Security</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <h1><a href="../roadmap.html">Roadmap</a></h1>
  </li>
  <li>
    <h1><a href="../goodies/index.html">Goodies</a></h1>
  </li>
</ul>


</div>

<a name="gc-pagecontent-anchor"></a>   
<div class="g-unit" id="gc-pagecontent">


<div id="jd-content">

<div class="jd-descr">
<h1>Developing Responsive Applications</h1>

<p>In this article, we'll cover how Android determines if an application is
not responding (hereafter called ANR), the causes of ANR, and guidelines for
ensuring that your application is responsive. There are a set of best
practices &mdash; in addition to <a
href="../toolbox/performance.html">writing efficient Android
code</a> &mdash; that will help ensure that your application's user interface is
responsive. But before delving into the details, here's a screenshot of what
the dialog box created by Android when an application is not responding looks
like:</p>

<h2>When Good Applications Go Bad</h2>

<div class="sidebox" style="margin-top:1em;border:0;">
<div style="border:0;background-color:#fff;padding:15px;padding-right:2em;margin:0;">
<img src="/android/images/anr.png" width="240" height="320" alt="Screenshot of ANR dialog box">
<p style="margin-top:.5em;padding:.5em;">An ANR dialog displayed to the user.</p>
</div>
</div>

<p>In Android, application responsiveness is monitored by the Activity Manager
and Window Manager system services. Android will display the ANR dialog
for a particular application when it detects one of the following
conditions:<p>
<ul>  
    <li>No response to an input event (e.g. key press, screen touch) within 5 seconds</li>
    <li>A <a href="../reference/android/content/BroadcastReceiver.html">BroadcastReceiver</a> hasn't finished executing within 10 seconds</li>
</ul>

<h2>Avoiding ANR</h2>

<p>Given the above definition for ANR, let's examine why this can occur in
Android applications and how best to structure your application to avoid ANR.</p>

<p>Android applications normally run entirely on a single (i.e. main) thread.
This means that anything your application is doing in the main thread that
takes a long time to complete can trigger the ANR dialog because your
application is not giving itself a chance to handle the input event or Intent
broadcast.</p>

<p>Therefore any method that runs in the main thread should do as little work
as possible. In particular, Activities should do as little as possible to set
up in key life-cycle methods such as <code>onCreate()</code> and
<code>onResume()</code>. Potentially long running operations such as network
or database operations, or computationally expensive calculations such as
resizing bitmaps should be done in a child thread (or in the case of databases
operations, via an asynchronous request). However, this does not mean that
your main thread should block while waiting for the child thread to
complete &mdash; nor should you call <code>Thread.wait()</code> or
<code>Thread.sleep()</code>. Instead of blocking while waiting for a child
thread to complete, your main thread should provide a <a href="../reference/android/os/Handler.html">Handler</a> for child threads to post back to upon completion.
Designing your application in this way will allow your main thread to remain
responsive to input and thus avoid ANR dialogs caused by the 5 second input
event timeout. These same practices should be followed for any other threads
that display UI, as they are also subject to the same timeouts.</p>

<p>The specific constraint on IntentReciever execution time emphasizes what
they were meant to do: small, discrete amounts of work in the background such
as saving a setting or registering a Notification. So as with other methods
called in the main thread, applications should avoid potentially long-running
operations or calculations in BroadcastReceivers. But instead of doing intensive
tasks via child threads (as the life of a BroadcastReceiver is short), your
application should start a <a href="../reference/android/app/Service.html">Service</a> if a
potentially long running action needs to be taken in response to an Intent
broadcast. As a side note, you should also avoid starting an Activity from an
Intent Receiver, as it will spawn a new screen that will steal focus from
whatever application the user is currently has running. If your application
has something to show the user in response to an Intent broadcast, it should
do so using the <a href="../reference/android/app/NotificationManager.html">Notification
Manager</a>.</p>

<h2>Reinforcing Responsiveness</h2>

<p>Generally, 100 to 200ms is the threshold beyond which users will perceive
lag (or lack of "snappiness," if you will) in an application. As such, here
are some additional tips beyond what you should do to avoid ANR that will help
make your application seem responsive to users.</p>

<ul>
    <li>If your application is doing work in the background in response to
    user input, show that progress is being made (<a href="../reference/android/widget/ProgressBar.html">ProgressBar</a> and <a href="../reference/android/app/ProgressDialog.html">ProgressDialog</a> are useful for this).</li>
    <li>For games specifically, do calculations for moves in a child
    thread.</li>
    <li>If your application has a time-consuming initial setup phase, consider
    showing a splash screen or rendering the main view as quickly as possible
    and filling in the information asynchronously. In either case, you should
    indicate somehow that progress is being made, lest the user perceive that
    the application is frozen.</li>
</ul>

</div>

</div>
</div><!-- end gc-pagecontent -->
</div><!-- end gooey wrapper -->

<div style="padding-left: 10px; padding-right: 10px; margin-top: 0; padding-bottom: 15px;">
    <table style="width: 100%; border:none;"><tr>
    <td style="border: none; width: 150px;"></td>
    <td style="text-align: left; font-size: 10pt; border: none; color: silver;">Copyright 2007 <a href="http://labs.google.com/">Google Inc.</a></td>
    <td style="text-align: right; font-size: 10pt; border: none; color: silver;">Build 119366-119366 - 19 Nov 2008 16:04</td>
    </tr></table>
</div>


</body>

</html>


